<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>í…ìŠ¤íŠ¸ ì•„íŠ¸ ìƒì„±ê¸° - textartkorea.com</title>
<!-- favicon -->
  <link rel="icon" type="image/ico" sizes="32x32" href="/favicon.ico">
<meta name="description" content="ì´ë¯¸ì§€ë¥¼ í…ìŠ¤íŠ¸ ì•„íŠ¸ë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”">
<meta property="og:type" content="website">
<meta property="og:title" content="í…ìŠ¤íŠ¸ ì•„íŠ¸ ìƒì„±ê¸° - textartkorea.com">
<meta property="og:description" content="ì´ë¯¸ì§€ë¥¼ í…ìŠ¤íŠ¸ ì•„íŠ¸ë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”">
<meta property="og:site_name" content="textartkorea.com">
 <meta property="og:image" content="https://textartkorea.com/preview.jpg">
  <meta property="og:url" content="https://textartkorea.com">
<style>
  :root{--bg:#0b0f14;--panel:#111823;--text:#e5eef7;--muted:#94a3b8;--accent:#4f9cf9;--border:#1e293b}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:ui-monospace,monospace}
  .wrap{max-width:940px;margin:0 auto;padding:16px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px}
  .title{font-weight:800;font-size:18px}
  .sharebar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}
  .grid{display:grid;gap:12px}
  @media(min-width:960px){.grid{grid-template-columns:360px 1fr}}
  .drop{border:2px dashed #334155;border-radius:12px;padding:16px;text-align:center;background:#0f172a55;cursor:pointer}
  .drop:hover{border-color:var(--accent)}
  .drop input{display:none}
  .hint{color:var(--muted);font-size:12px}
  .notice{margin-top:8px;padding:10px;border:1px dashed #2b3b55;border-radius:10px;background:#0f172a88}
  .row{display:flex;justify-content:space-between;align-items:center;margin:8px 0;gap:10px}
  .row>div{flex:1}
  input[type="range"], select, input[type="color"]{width:100%}
  .btns{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  button{background:#1e293b;color:#dbeafe;border:1px solid #2b3b55;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  button.primary{background:linear-gradient(180deg,#3b82f6,#2563eb);color:#fff}
  button:disabled{opacity:.5;cursor:not-allowed}
  .iconbtn{display:inline-flex;align-items:center;gap:6px}
  pre#ascii{margin:0;white-space:pre;overflow:auto;background:#000;color:#fff;padding:10px;border-radius:12px;line-height:1em}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">ğŸ”¤ í…ìŠ¤íŠ¸ ì•„íŠ¸ ìƒì„±ê¸°</div>
    <div class="sharebar">
      <button id="shareSite" class="iconbtn">ğŸ“¤ ì¹œêµ¬ì—ê²Œ ê³µìœ </button>
    </div>
  </header>

  <div class="grid">
    <!-- ì™¼ìª½: ì»¨íŠ¸ë¡¤ -->
    <div class="panel">
      <label class="drop" id="drop">
        <input id="file" type="file" accept="image/*">
        <div><strong>ì´ë¯¸ì§€ë¥¼ ë“œë¡­</strong>í•˜ê±°ë‚˜ íƒ­í•˜ì—¬ ì—…ë¡œë“œ</div>
        <div class="hint">í´ë¦½ë³´ë“œì—ì„œ ë¶™ì—¬ë„£ê¸°ë„ ê°€ëŠ¥</div>
      </label>

      <div class="notice">ğŸ’¡ <strong>ì´ë¯¸ì§€ë¡œ ì €ì¥í•´ì•¼ ì˜ˆì˜ê²Œ ë³´ì—¬ìš”.</strong> ì¹´í†¡ì€ í°íŠ¸ê°€ ë‹¬ë¼ ì¤„ë§ì¶¤ì´ ê¹¨ì§ˆ ìˆ˜ ìˆì–´ìš”.</div>

      <div class="row">
        <div>
          <label class="hint">ì¶œë ¥ í­: <span id="wVal">120</span>ì—´</label>
          <input id="width" type="range" min="30" max="300" value="120">
        </div>
        <div>
          <label class="hint">í°íŠ¸ í¬ê¸°: <span id="fsVal">12</span>px</label>
          <input id="fontsize" type="range" min="8" max="20" value="12">
        </div>
      </div>

      <div class="row">
        <div>
          <label class="hint" for="mode">ëª¨ë“œ</label>
          <select id="mode">
            <option value="mono" selected>í‘ë°±</option>
            <option value="color">ì»¬ëŸ¬</option>
          </select>
        </div>
        <div>
          <label class="hint" for="fontColor">í°íŠ¸ ìƒ‰ìƒ(í‘ë°±)</label>
          <input id="fontColor" type="color" value="#ffffff">
        </div>
        <div>
          <label class="hint" for="bgColor">ë°°ê²½ ìƒ‰ìƒ</label>
          <input id="bgColor" type="color" value="#000000">
        </div>
      </div>

      <div class="btns">
        <button id="render" class="primary" disabled>ë§Œë“¤ê¸°</button>
        <button id="copyBtn" class="iconbtn" disabled>ğŸ“‹ ë³µì‚¬</button>
        <button id="shareImage" disabled>ì´ë¯¸ì§€ ê³µìœ </button>
        <button id="savePng" disabled>ì´ë¯¸ì§€ ì €ì¥</button>
        <button id="clear">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸°/ì¶œë ¥ -->
    <div class="panel">
      <div id="preview" style="margin-bottom:8px"></div>
      <pre id="ascii"></pre>
    </div>
  </div>
</div>

<!-- ë‚´ë¶€ ì²˜ë¦¬ìš© ìº”ë²„ìŠ¤ -->
<canvas id="canvas" style="display:none"></canvas>

<script>
const fileInput=document.getElementById('file');
const drop=document.getElementById('drop');
const preview=document.getElementById('preview');
const asciiPre=document.getElementById('ascii');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d',{willReadFrequently:true});

const widthRange=document.getElementById('width');
const fontsizeRange=document.getElementById('fontsize');
const wVal=document.getElementById('wVal');
const fsVal=document.getElementById('fsVal');

const modeSel=document.getElementById('mode');
const fontColorInp=document.getElementById('fontColor');
const bgColorInp=document.getElementById('bgColor');

const btnRender=document.getElementById('render');
const btnCopy=document.getElementById('copyBtn');
const btnSavePng=document.getElementById('savePng');
const btnShareImage=document.getElementById('shareImage');
const btnClear=document.getElementById('clear');
const btnShareSite=document.getElementById('shareSite');

let img=null;
let latestAsciiText='';
let latestColorGrid=null; // ì»¬ëŸ¬ ëª¨ë“œì¼ ë•Œ ë¬¸ì ìƒ‰ìƒ ì €ì¥
const CHARSET="@%#*+=-:. ";

function clamp(v,min,max){return Math.max(min,Math.min(max,v))}
function toHex(v){v=clamp(v|0,0,255);return ('0'+v.toString(16)).slice(-2)}
function rgbToHex(r,g,b){return '#'+toHex(r)+toHex(g)+toHex(b)}

function readFile(file){
  if(!file) return;
  const url=URL.createObjectURL(file);
  const image=new Image();
  image.onload=()=>{
    img=image;
    preview.innerHTML=`<img src="${url}" style="max-width:100%;border-radius:8px;border:1px solid #1e293b">`;
    btnRender.disabled=false;
    asciiPre.innerHTML='';
    latestAsciiText='';
    latestColorGrid=null;
  };
  image.onerror=()=>alert('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
  image.src=url;
}

// íŒŒì¼ ì…ë ¥/ë“œë˜ê·¸/ë¶™ì—¬ë„£ê¸°
fileInput.addEventListener('change',e=>readFile(e.target.files?.[0]));
drop.addEventListener('click',()=>fileInput.click());
['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();e.stopPropagation();}));
drop.addEventListener('drop',e=>{e.preventDefault();e.stopPropagation();readFile(e.dataTransfer.files?.[0]);});
window.addEventListener('paste',e=>{
  const items=e.clipboardData?.items; if(!items) return;
  for(const it of items){ if(it.type.startsWith('image/')){ readFile(it.getAsFile()); break; } }
});

// UI í‘œì‹œê°’
widthRange.addEventListener('input',()=>wVal.textContent=widthRange.value);
fontsizeRange.addEventListener('input',()=>{fsVal.textContent=fontsizeRange.value;asciiPre.style.fontSize=fontsizeRange.value+'px';});
modeSel.addEventListener('change',()=>{
  fontColorInp.disabled = (modeSel.value==='color');
  if(img) renderASCII();
});
fontColorInp.addEventListener('input',()=>{ if(modeSel.value==='mono' && latestAsciiText) asciiPre.style.color = fontColorInp.value; });
bgColorInp.addEventListener('input',()=>{ if(latestAsciiText) asciiPre.style.background = bgColorInp.value; });

// í•µì‹¬ ë Œë”ë§
function renderASCII(){
  if(!img) return;
  const targetCols=parseInt(widthRange.value,10);
  const fontSize=parseInt(fontsizeRange.value,10);
  const mode=modeSel.value; // 'mono' | 'color'
  const charAspect=2.0;

  // ë¦¬ì‚¬ì´ì¦ˆ í›„ ìƒ˜í”Œë§
  const scale=targetCols/img.width;
  const targetRows=Math.max(1,Math.round(img.height*scale/charAspect));
  canvas.width=targetCols; canvas.height=targetRows;
  ctx.imageSmoothingEnabled=true; ctx.imageSmoothingQuality='high';
  ctx.drawImage(img,0,0,canvas.width,canvas.height);

  const {data,width,height}=ctx.getImageData(0,0,canvas.width,canvas.height);

  const lines=[]; const colorGrid=[];
  for(let y=0;y<height;y++){
    let line=''; const rowColors=[];
    for(let x=0;x<width;x++){
      const i=(y*width+x)*4;
      const r=data[i], g=data[i+1], b=data[i+2], a=data[i+3];
      const lum=0.2126*r + 0.7152*g + 0.0722*b;
      const t=clamp(lum/255,0,1);
      const idx=Math.round((1-t)*(CHARSET.length-1));
      const ch=CHARSET[idx]||' ';
      line+=ch;
      if(mode==='color'){
        const color=(a<10)? bgColorInp.value : rgbToHex(r,g,b);
        rowColors.push(color);
      }
    }
    lines.push(line);
    if(mode==='color') colorGrid.push(rowColors);
  }

  // ì›Œí„°ë§ˆí¬(í•­ìƒ í‘œì‹œ, ë§ˆì§€ë§‰ ì¤„ ëì— ê³ ì •)
  const domain="textartkorea.com";
  if(lines.length){
    const last=lines[lines.length-1];
    const start=Math.max(0,last.length-domain.length);
    lines[lines.length-1]=last.slice(0,start)+domain;

    if(mode==='color'){
      const rowIdx=lines.length-1;
      const cols=lines[0]?.length||0;
      const startCol=Math.max(0, cols-domain.length);
      for(let c=0;c<domain.length && (startCol+c)<cols;c++){
        colorGrid[rowIdx][startCol+c]='#ffffff';
      }
    }
  }else{
    lines.push(domain);
    if(mode==='color') colorGrid.push(domain.split('').map(()=> '#ffffff'));
  }

  latestAsciiText=lines.join('\n');
  latestColorGrid=(mode==='color') ? colorGrid : null;

  // UI ë°˜ì˜
  asciiPre.style.fontSize=fontSize+'px';
  asciiPre.style.background=bgColorInp.value;

  if(mode==='mono'){
    asciiPre.style.color=fontColorInp.value;
    asciiPre.textContent=latestAsciiText;
  }else{
    const rowsHtml=[];
    for(let y=0;y<lines.length;y++){
      const chars=lines[y]; const colors=colorGrid[y];
      let html='';
      for(let x=0;x<chars.length;x++){
        const ch=chars[x];
        html += `<span style="color:${colors[x]}">${ch===' ' ? '&nbsp;' : ch}</span>`;
      }
      rowsHtml.push(html);
    }
    asciiPre.innerHTML=rowsHtml.join('<br>');
  }

  btnCopy.disabled=false;
  btnSavePng.disabled=false;
  btnShareImage.disabled=false;
}

// PNGë¡œ ê·¸ë¦¬ê¸° ê³µí†µ ë£¨í‹´ (ì €ì¥/ê³µìœ  ë‘˜ ë‹¤ ì‚¬ìš©)
async function buildImageBlob(){
  if(!latestAsciiText) return null;

  const mode=modeSel.value;
  const fontSize=parseInt(fontsizeRange.value,10);
  const fontColor=fontColorInp.value;
  const bgColor=bgColorInp.value;

  const tmp=document.createElement('canvas');
  const tctx=tmp.getContext('2d');
  const fontFamily='ui-monospace, SFMono-Regular, Menlo, Consolas, monospace';
  tctx.font=`${fontSize}px ${fontFamily}`;
  const charWidth=tctx.measureText('M').width;

  const lines=latestAsciiText.split('\n');
  const cols=Math.max(...lines.map(l=>l.length));
  const rows=lines.length;
  const pad=Math.round(fontSize*0.7);

  tmp.width=Math.ceil(pad + cols*charWidth + pad);
  tmp.height=Math.ceil(pad + rows*fontSize + pad);

  tctx.fillStyle=bgColor; tctx.fillRect(0,0,tmp.width,tmp.height);
  tctx.font=`${fontSize}px ${fontFamily}`;
  tctx.textBaseline='top';

  if(mode==='mono'){
    tctx.fillStyle=fontColor;
    for(let r=0;r<rows;r++){ tctx.fillText(lines[r], pad, pad + r*fontSize); }
  }else{
    for(let r=0;r<rows;r++){
      const chars=lines[r];
      const colors=latestColorGrid[r];
      let xPad=pad;
      for(let c=0;c<chars.length;c++){
        tctx.fillStyle=colors[c];
        tctx.fillText(chars[c], xPad, pad + r*fontSize);
        xPad += charWidth;
      }
    }
  }
  return await new Promise(res=> tmp.toBlob(res, 'image/png'));
}

// ë²„íŠ¼ë“¤
btnRender.addEventListener('click',renderASCII);

btnCopy.addEventListener('click',async()=>{
  try{ await navigator.clipboard.writeText(latestAsciiText); alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); }
  catch(e){ alert('ë³µì‚¬ ì‹¤íŒ¨. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.'); }
});

btnSavePng.addEventListener('click',async()=>{
  const blob=await buildImageBlob();
  if(!blob){ alert('ë¨¼ì € ë§Œë“¤ê¸°ë¥¼ ëˆŒëŸ¬ ì¶œë ¥ë¬¼ì„ ìƒì„±í•˜ì„¸ìš”.'); return; }
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='text-art.png';
  a.click();
});

btnShareImage.addEventListener('click',async()=>{
  const blob=await buildImageBlob();
  if(!blob){ alert('ë¨¼ì € ë§Œë“¤ê¸°ë¥¼ ëˆŒëŸ¬ ì¶œë ¥ë¬¼ì„ ìƒì„±í•˜ì„¸ìš”.'); return; }
  const file=new File([blob],'text-art.png',{type:'image/png'});
  if(navigator.canShare && navigator.canShare({files:[file]})){
    try{
      await navigator.share({files:[file], title:'í…ìŠ¤íŠ¸ ì•„íŠ¸', text:'í…ìŠ¤íŠ¸ ì•„íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.'});
    }catch(e){ /* ì‚¬ìš©ìê°€ ì·¨ì†Œí•  ìˆ˜ ìˆìŒ */ }
  }else{
    // í´ë°±: ë‹¤ìš´ë¡œë“œë¡œ ëŒ€ì²´í•˜ê³  ì•ˆë‚´
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='text-art.png';
    a.click();
    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ì´ë¯¸ì§€ ê³µìœ ë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ ë‹¤ìš´ë¡œë“œë¡œ ëŒ€ì²´í–ˆì–´ìš”. ë‹¤ìš´ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ê³µìœ í•´ ì£¼ì„¸ìš”.');
  }
});

// ìµœìƒë‹¨: ì‚¬ì´íŠ¸ ê³µìœ 
btnShareSite.addEventListener('click',async()=>{
  const shareData={title:'í…ìŠ¤íŠ¸ ì•„íŠ¸ ìƒì„±ê¸°', text:'ì´ë¯¸ì§€ë¥¼ í…ìŠ¤íŠ¸ ì•„íŠ¸ë¡œ ë³€í™˜í•´ë³´ì„¸ìš”!', url:location.href};
  if(navigator.share){
    try{ await navigator.share(shareData); }catch(e){ /* ì‚¬ìš©ìê°€ ì·¨ì†Œ ê°€ëŠ¥ */ }
  }else{
    try{
      await navigator.clipboard.writeText(location.href);
      alert('ì‚¬ì´íŠ¸ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆì–´ìš”!');
    }catch(e){
      alert('ê³µìœ ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤. ì£¼ì†Œë¥¼ ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”: '+location.href);
    }
  }
});

btnClear.addEventListener('click',()=>{
  img=null; latestAsciiText=''; latestColorGrid=null;
  fileInput.value=''; preview.innerHTML=''; asciiPre.innerHTML='';
  btnRender.disabled=true; btnCopy.disabled=true; btnSavePng.disabled=true; btnShareImage.disabled=true;
});

// ì´ë¯¸ì§€ ë¡œë“œ ê°ì§€í•´ì„œ 'ë§Œë“¤ê¸°' í™œì„±í™”
const mo=new MutationObserver(()=>{btnRender.disabled=!img;});
mo.observe(preview,{childList:true});

// ì´ˆê¸° ìƒíƒœ
wVal.textContent=widthRange.value;
fsVal.textContent=fontsizeRange.value;
fontColorInp.disabled = (modeSel.value==='color');
</script>
</body>
</html>
