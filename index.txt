<!DOCTYPE html>
<html lang="ko">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-93TFLCBY3F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-93TFLCBY3F');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9891583086388017"
     crossorigin="anonymous"></script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>텍스트 아트 생성기 - textartkorea.com</title>

<!-- favicon -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- Open Graph -->
<meta name="description" content="이미지를 텍스트 아트로 만들어보세요">
<meta property="og:type" content="website">
<meta property="og:title" content="텍스트 아트 생성기 - textartkorea.com">
<meta property="og:description" content="이미지를 텍스트 아트로 만들어보세요">
<meta property="og:site_name" content="textartkorea.com">
<meta property="og:image" content="https://textartkorea.com/preview.jpg">
<meta property="og:url" content="https://textartkorea.com">

<style>
  :root{
    --bg:#0b0f14; --panel:#111823; --text:#e5eef7; --muted:#94a3b8; --accent:#4f9cf9; --border:#1e293b
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace
  }
  .wrap{max-width:940px;margin:0 auto;padding:16px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px}
  .title{font-weight:800;font-size:18px}
  .sharebar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}
  .grid{display:grid;gap:12px}
  @media(min-width:960px){.grid{grid-template-columns:360px 1fr}}

  /* 업로드 영역 */
  .drop{
    border:2px dashed #334155;border-radius:12px;padding:18px;text-align:center;
    background:#0f172a55; cursor:pointer; user-select:none
  }
  .drop:hover{border-color:var(--accent)}
  .drop strong.underline{ text-decoration: underline; }

  .hint{color:var(--muted);font-size:12px}
  .notice{margin-top:10px;padding:10px;border:1px dashed #2b3b55;border-radius:10px;background:#0f172a88}

  /* 컨트롤 - 한 줄에 하나씩 */
  .control{
    display:flex; flex-direction:column; gap:8px;
    margin:12px 0; padding:10px; border:1px solid var(--border); border-radius:10px; background:#0f172a66
  }
  .control label{font-size:12px;color:var(--muted)}
  .control input[type="range"], .control select, .control input[type="color"]{width:100%}

  .btns{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  button{
    background:#1e293b;color:#dbeafe;border:1px solid #2b3b55;
    padding:11px 14px;border-radius:10px;font-weight:700;cursor:pointer
  }
  button.primary{background:linear-gradient(180deg,#3b82f6,#2563eb);color:#fff}
  button:disabled{opacity:.55;cursor:not-allowed}
  .iconbtn{display:inline-flex;align-items:center;gap:6px}

  pre#ascii{
    margin:0; white-space:pre; overflow:auto; background:#000; color:#fff;
    padding:12px; border-radius:12px; line-height:1em; min-height:200px
  }

  /* 모바일 여백 조금 더 */
  @media(max-width:480px){
    .control{margin:10px 0; padding:10px}
    .btns{gap:10px}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">🔤 텍스트 아트 생성기</div>
    <div class="sharebar">
      <button id="shareSite" class="iconbtn">📤 친구에게 공유</button>
    </div>
  </header>

  <div class="grid">
    <!-- 좌측: 컨트롤 -->
    <div class="panel">
      <!-- 숨김 파일 입력 -->
      <input id="file" type="file" accept="image/*" style="display:none">

      <!-- 업로드 영역 (더블 선택 방지: label 제거, div 클릭/키보드로만 트리거) -->
      <div class="drop" id="drop" role="button" tabindex="0" aria-label="이미지를 드롭하거나 여기를 탭하여 업로드">
        <div><strong>이미지 드롭</strong>하거나 <strong class="underline">여기를 탭하여 업로드</strong></div>
        <div class="hint">클립보드에서 붙여넣기도 가능</div>
      </div>

      <div class="notice">💡 <strong>이미지로 저장해야 예쁘게 보여요.</strong> 카톡은 폰트가 달라 줄맞춤이 깨질 수 있어요. 모바일에선 50열 이하 권장.</div>

      <!-- 컨트롤: 각 항목 한 줄 -->
      <div class="control">
        <label>출력 폭: <span id="wVal">50</span>열</label>
        <input id="width" type="range" min="30" max="300" value="50">
      </div>

      <div class="control">
        <label>폰트 크기: <span id="fsVal">12</span>px</label>
        <input id="fontsize" type="range" min="8" max="20" value="12">
      </div>

      <div class="control">
        <label for="mode">모드</label>
        <select id="mode">
          <option value="mono" selected>흑백</option>
          <option value="color">컬러</option>
        </select>
      </div>

      <div class="control">
        <label for="fontColor">폰트 색상(흑백)</label>
        <input id="fontColor" type="color" value="#ffffff">
      </div>

      <div class="control">
        <label for="bgColor">배경 색상</label>
        <input id="bgColor" type="color" value="#000000">
      </div>

      <div class="btns">
        <button id="render" class="primary" disabled>만들기</button>
        <button id="copyBtn" class="iconbtn" disabled>📋 복사</button>
        <button id="shareImage" disabled>이미지 공유</button>
        <button id="savePng" disabled>이미지 저장</button>
        <button id="clear">초기화</button>
      </div>
    </div>

    <!-- 우측: 미리보기/출력 -->
    <div class="panel">
      <div id="preview" style="margin-bottom:8px"></div>
      <pre id="ascii"></pre>
    </div>
  </div>
</div>

<!-- 내부 처리용 캔버스 -->
<canvas id="canvas" style="display:none"></canvas>

<script>
const fileInput=document.getElementById('file');
const drop=document.getElementById('drop');
const preview=document.getElementById('preview');
const asciiPre=document.getElementById('ascii');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d',{willReadFrequently:true});

const widthRange=document.getElementById('width');
const fontsizeRange=document.getElementById('fontsize');
const wVal=document.getElementById('wVal');
const fsVal=document.getElementById('fsVal');

const modeSel=document.getElementById('mode');
const fontColorInp=document.getElementById('fontColor');
const bgColorInp=document.getElementById('bgColor');

const btnRender=document.getElementById('render');
const btnCopy=document.getElementById('copyBtn');
const btnSavePng=document.getElementById('savePng');
const btnShareImage=document.getElementById('shareImage');
const btnClear=document.getElementById('clear');
const btnShareSite=document.getElementById('shareSite');

let img=null;
let latestAsciiText='';
let latestColorGrid=null; // 컬러 모드일 때 문자 색상 저장
const CHARSET="@%#*+=-:. ";

function clamp(v,min,max){return Math.max(min,Math.min(max,v))}
function toHex(v){v=clamp(v|0,0,255);return ('0'+v.toString(16)).slice(-2)}
function rgbToHex(r,g,b){return '#'+toHex(r)+toHex(g)+toHex(b)}

function readFile(file){
  if(!file) return;
  const url=URL.createObjectURL(file);
  const image=new Image();
  image.onload=()=>{
    img=image;
    preview.innerHTML=`<img src="${url}" style="max-width:100%;border-radius:8px;border:1px solid #1e293b">`;
    btnRender.disabled=false;
    asciiPre.innerHTML='';
    latestAsciiText=''; latestColorGrid=null;
  };
  image.onerror=()=>alert('이미지를 불러오지 못했습니다.');
  image.src=url;
}

// 업로드: 클릭/키보드/드래그/붙여넣기
drop.addEventListener('click',()=> fileInput.click());
drop.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); fileInput.click(); }});
fileInput.addEventListener('change',e=> readFile(e.target.files?.[0]));
['dragenter','dragover'].forEach(ev=> drop.addEventListener(ev,e=>{e.preventDefault(); e.stopPropagation();}));
drop.addEventListener('drop',e=>{e.preventDefault(); e.stopPropagation(); readFile(e.dataTransfer.files?.[0]);});
window.addEventListener('paste',e=>{
  const items=e.clipboardData?.items; if(!items) return;
  for(const it of items){ if(it.type.startsWith('image/')){ readFile(it.getAsFile()); break; } }
});

// UI 표시값
widthRange.addEventListener('input',()=> wVal.textContent = widthRange.value);
fontsizeRange.addEventListener('input',()=>{ fsVal.textContent = fontsizeRange.value; asciiPre.style.fontSize = fontsizeRange.value+'px'; });
modeSel.addEventListener('change',()=>{ fontColorInp.disabled = (modeSel.value==='color'); if(img) renderASCII(); });
fontColorInp.addEventListener('input',()=>{ if(modeSel.value==='mono' && latestAsciiText) asciiPre.style.color = fontColorInp.value; });
bgColorInp.addEventListener('input',()=>{ if(latestAsciiText) asciiPre.style.background = bgColorInp.value; });

// 핵심 렌더링
function renderASCII(){
  if(!img) return;
  const targetCols=parseInt(widthRange.value,10);
  const fontSize=parseInt(fontsizeRange.value,10);
  const mode=modeSel.value; // 'mono' | 'color'
  const charAspect=2.0;

  // 리사이즈 후 샘플링
  const scale=targetCols/img.width;
  const targetRows=Math.max(1,Math.round(img.height*scale/charAspect));
  canvas.width=targetCols; canvas.height=targetRows;
  ctx.imageSmoothingEnabled=true; ctx.imageSmoothingQuality='high';
  ctx.drawImage(img,0,0,canvas.width,canvas.height);

  const {data,width,height}=ctx.getImageData(0,0,canvas.width,canvas.height);

  const lines=[]; const colorGrid=[];
  for(let y=0;y<height;y++){
    let line=''; const rowColors=[];
    for(let x=0;x<width;x++){
      const i=(y*width+x)*4;
      const r=data[i], g=data[i+1], b=data[i+2], a=data[i+3];
      const lum=0.2126*r + 0.7152*g + 0.0722*b;
      const t=clamp(lum/255,0,1);
      const idx=Math.round((1-t)*(CHARSET.length-1));
      const ch=CHARSET[idx]||' ';
      line+=ch;
      if(mode==='color'){
        const color=(a<10)? bgColorInp.value : rgbToHex(r,g,b);
        rowColors.push(color);
      }
    }
    lines.push(line);
    if(mode==='color') colorGrid.push(rowColors);
  }

  // 워터마크(항상 표시, 마지막 줄 끝에 고정)
  const domain="textartkorea.com";
  if(lines.length){
    const last=lines[lines.length-1];
    const start=Math.max(0,last.length-domain.length);
    lines[lines.length-1]=last.slice(0,start)+domain;

    if(mode==='color'){
      const rowIdx=lines.length-1;
      const cols=lines[0]?.length||0;
      const startCol=Math.max(0, cols-domain.length);
      for(let c=0;c<domain.length && (startCol+c)<cols;c++){
        colorGrid[rowIdx][startCol+c]='#ffffff';
      }
    }
  }else{
    lines.push(domain);
    if(mode==='color') colorGrid.push(domain.split('').map(()=> '#ffffff'));
  }

  latestAsciiText=lines.join('\n');
  latestColorGrid=(mode==='color') ? colorGrid : null;

  // 화면 적용
  asciiPre.style.fontSize=fontSize+'px';
  asciiPre.style.background=bgColorInp.value;

  if(mode==='mono'){
    asciiPre.style.color=fontColorInp.value;
    asciiPre.textContent=latestAsciiText;
  }else{
    const rowsHtml=[];
    for(let y=0;y<lines.length;y++){
      const chars=lines[y]; const colors=colorGrid[y];
      let html='';
      for(let x=0;x<chars.length;x++){
        const ch=chars[x];
        html += `<span style="color:${colors[x]}">${ch===' ' ? '&nbsp;' : ch}</span>`;
      }
      rowsHtml.push(html);
    }
    asciiPre.innerHTML=rowsHtml.join('<br>');
  }

  btnCopy.disabled=false;
  btnSavePng.disabled=false;
  btnShareImage.disabled=false;
}

// PNG 빌드(저장/공유 공용)
async function buildImageBlob(){
  if(!latestAsciiText) return null;

  const mode=modeSel.value;
  const fontSize=parseInt(fontsizeRange.value,10);
  const fontColor=fontColorInp.value;
  const bgColor=bgColorInp.value;

  const tmp=document.createElement('canvas');
  const tctx=tmp.getContext('2d');
  const fontFamily='ui-monospace, SFMono-Regular, Menlo, Consolas, monospace';
  tctx.font=`${fontSize}px ${fontFamily}`;
  const charWidth=tctx.measureText('M').width;

  const lines=latestAsciiText.split('\n');
  const cols=Math.max(...lines.map(l=>l.length));
  const rows=lines.length;
  const pad=Math.round(fontSize*0.7);

  tmp.width=Math.ceil(pad + cols*charWidth + pad);
  tmp.height=Math.ceil(pad + rows*fontSize + pad);

  tctx.fillStyle=bgColor; tctx.fillRect(0,0,tmp.width,tmp.height);
  tctx.font=`${fontSize}px ${fontFamily}`;
  tctx.textBaseline='top';

  if(mode==='mono'){
    tctx.fillStyle=fontColor;
    for(let r=0;r<rows;r++){ tctx.fillText(lines[r], pad, pad + r*fontSize); }
  }else{
    for(let r=0;r<rows;r++){
      const chars=lines[r]; const colors=latestColorGrid[r];
      let xPad=pad;
      for(let c=0;c<chars.length;c++){
        tctx.fillStyle=colors[c];
        tctx.fillText(chars[c], xPad, pad + r*fontSize);
        xPad += charWidth;
      }
    }
  }
  return await new Promise(res=> tmp.toBlob(res, 'image/png'));
}

// 버튼
btnRender.addEventListener('click',renderASCII);

btnCopy.addEventListener('click',async()=>{
  try{ await navigator.clipboard.writeText(latestAsciiText); alert('복사되었습니다!'); }
  catch(e){ alert('복사 실패. 브라우저 권한을 확인하세요.'); }
});

btnSavePng.addEventListener('click',async()=>{
  const blob=await buildImageBlob();
  if(!blob){ alert('먼저 만들기를 눌러 출력물을 생성하세요.'); return; }
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='text-art.png';
  a.click();
});

btnShareImage.addEventListener('click',async()=>{
  const blob=await buildImageBlob();
  if(!blob){ alert('먼저 만들기를 눌러 출력물을 생성하세요.'); return; }
  const file=new File([blob],'text-art.png',{type:'image/png'});
  if(navigator.canShare && navigator.canShare({files:[file]})){
    try{ await navigator.share({files:[file], title:'텍스트 아트', text:'텍스트 아트를 공유합니다.'}); }
    catch(e){ /* 취소 가능 */ }
  }else{
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='text-art.png';
    a.click();
    alert('이 브라우저는 이미지 공유를 지원하지 않아 다운로드로 대체했어요. 다운로드된 이미지를 공유해 주세요.');
  }
});

// 사이트 공유
btnShareSite.addEventListener('click',async()=>{
  const shareData={title:'텍스트 아트 생성기', text:'이미지를 텍스트 아트로 변환해보세요!', url:location.href};
  if(navigator.share){
    try{ await navigator.share(shareData); }catch(e){}
  }else{
    try{ await navigator.clipboard.writeText(location.href); alert('사이트 주소가 복사되었어요!'); }
    catch(e){ alert('공유 미지원 브라우저입니다. 주소를 직접 복사해 주세요: '+location.href); }
  }
});

// 초기화
btnClear.addEventListener('click',()=>{
  img=null; latestAsciiText=''; latestColorGrid=null;
  fileInput.value=''; preview.innerHTML=''; asciiPre.innerHTML='';
  btnRender.disabled=true; btnCopy.disabled=true; btnSavePng.disabled=true; btnShareImage.disabled=true;
});

// 이미지 로드 감지해서 '만들기' 활성화
const mo=new MutationObserver(()=>{btnRender.disabled=!img;});
mo.observe(preview,{childList:true});

// 초기 상태
wVal.textContent=widthRange.value;
fsVal.textContent=fontsizeRange.value;
fontColorInp.disabled = (modeSel.value==='color');
</script>
</body>
<footer>
  <p style="text-align:center; color:#666; font-size:14px;">© 2025 textartkorea.com</p>
  <div style="max-width:100%; text-align:center; margin:20px 0;">
    <a href="https://iryan.kr/t7372qyi9v" target="_blank" rel="noopener">
      <img src="https://img.tenping.kr/Content/Upload/Content/2025080810130001_Con_20250811102256_5.jpg?RS=1200x1200" 
           alt="광고 배너" 
           style="max-width:100%; height:auto;">
    </a>
  </div>
</footer>
</html>